<!DOCTYPE html>
<!--
Copyright 2012 Mozilla Foundation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

Adobe CMap resources are covered by their own copyright but the same license:

    Copyright 1990-2015 Adobe Systems Incorporated.

See https://github.com/adobe-type-tools/cmap-resources
-->
<html dir="ltr" mozdisallowselectionprint>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <meta name="google" content="notranslate" />
    <title>PDF.js viewer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script
      type="module"
      src="{{ url_for('serve_build', filename='pdf.mjs') }}"
    ></script>

    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('custom_static', filename='viewer.css') }}"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('custom_static', filename='bootstrap.min.css') }}"
    />

    <script
      type="module"
      src="{{ url_for('custom_static', filename='viewer.mjs') }}"
    ></script>
    <!-- 
<script type="module">
  import { pdfjsLib } from '/build/pdf.mjs';

  // Configure the workerSrc property
  pdfjsLib.GlobalWorkerOptions.workerSrc = "{{ url_for('serve_build', filename='pdf.worker.mjs') }}";

  // Your code to load and display PDFs using pdfjsLib
</script> -->
    <style>
      .content {
        display: flex;
        justify-content: space-around;
      }
      body {
        background-color: none;
      }
      .note {
        display: block;
        margin-top: 10px;
        font-size: 12px;
        color: #000;
        background-color: rgb(205, 205, 205);
        padding: 2px 5px;
        border-radius: 3px;
      }
      .select {
        background-color: rgb(255, 255, 0, 0.3);
        z-index: 1;
      }

      .position-relative {
        z-index: 1 !important;
      }
      .page {
        background-color: yellow;
        margin-left: 3px;
      }
      .hide {
        display: none;
      }

      .container {
        display: block;
      }
      .page-2 {
        margin: 0;
        background-color: white;
      }
      .charts-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        padding-top: 20px;
        padding-bottom: 20px;
      }
      .toolbar {
        z-index: 1;
      }
      .chart-container {
        background: white;
        padding: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: center;
        align-items: center;
      }
      canvas {
        width: 500px;
      }
      .table-container {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }
      .button {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 10px;
      }
      button {
        background-color: #0d6efd;
        border-color: #0d6efd;
        color: white;
        border-radius: 10px;
        margin-top: 20px;
        margin-right: 15px;
      }
      .button button {
        padding: 10px 20px;
        margin: 0 10px;
        font-size: 16px;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .button button:nth-child(1) {
        background-color: #007bff;
      }
      .button button:nth-child(2) {
        background-color: red;
      }

      .table-wrapper {
        display: block;
        max-height: 555px;
        min-height: 555px;
        overflow-y: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 8px;
        text-align: center;
      }

      th {
        background-color: #f2f2f2;
      }

      tr:nth-child(even) {
        background-color: #f9f9f9;
      }

      tr:nth-child(odd) {
        background-color: white;
      }

      tr:hover {
        background-color: #ddd;
      }

      .sticky-header th {
        position: sticky;
        top: 0;
        background: #f2f2f2;
      }

      /* Container for the questions */
      #new-question,
      #old-question {
        width: 50%;
        padding: 20px;
        box-sizing: border-box;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: #f9f9f9;
      }

      /* Common styling for content sections */
      .question-content,
      .answer,
      .difficulty,
      .learning_outcome,
      .subchapters,
      .instruction {
        margin-bottom: 15px;
      }

      /* Styling for each individual section */
      .question-content {
        font-weight: bold;
        font-size: 1.2em;
      }

      .answer {
        color: #007bff;
      }

      .difficulty {
        color: #28a745;
      }

      .learning_outcome {
        color: #17a2b8;
      }

      .subchapters {
        color: #ffc107;
      }

      .instruction {
        color: #6c757d;
      }

      /* Flexbox layout for the container */
      div[style*="display: flex;"] {
        display: flex;
        gap: 20px;
      }

      input {
        border: 1px solid #ccc;
        padding: 10px;
        border-radius: 5px;
      }

      button {
        background-color: #8f9295;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
      }
      textarea {
        border: 1px solid #ccc;
      }

      #chart01,
      #chart02,
      #chart03,
      #chart04 {
        width: 550px !important;
        height: 400px !important;
      }

      #chart11,
      #chart12,
      #chart13 {
        width: 700px !important;
        height: 400px !important;
      }
    </style>
  </head>

  <body tabindex="1">
    <div class="page-1" style="width: 60%; margin: 10px; padding: 10px">
      <div id="outerContainer" onmouseup="getSelectedText()">
        <div id="sidebarContainer">
          <div id="toolbarSidebar">
            <div id="toolbarSidebarLeft">
              <div
                id="sidebarViewButtons"
                class="splitToolbarButton toggled"
                role="radiogroup"
              >
                <button
                  id="viewThumbnail"
                  class="toolbarButton toggled"
                  title="Show Thumbnails"
                  tabindex="2"
                  data-l10n-id="pdfjs-thumbs-button"
                  role="radio"
                  aria-checked="true"
                  aria-controls="thumbnailView"
                  onclick="show()"
                >
                  <span data-l10n-id="pdfjs-thumbs-button-label"
                    >Thumbnails</span
                  >
                </button>
                <button
                  id="viewOutline"
                  class="toolbarButton"
                  title="Show Document Outline (double-click to expand/collapse all items)"
                  tabindex="3"
                  data-l10n-id="pdfjs-document-outline-button"
                  role="radio"
                  aria-checked="false"
                  aria-controls="outlineView"
                  onclick="show()"
                >
                  <span data-l10n-id="pdfjs-document-outline-button-label"
                    >Document Outline</span
                  >
                </button>
                <button
                  id="viewAttachments"
                  class="toolbarButton"
                  title="Show Attachments"
                  tabindex="4"
                  data-l10n-id="pdfjs-attachments-button"
                  role="radio"
                  aria-checked="false"
                  aria-controls="attachmentsView"
                  onclick="show()"
                >
                  <span data-l10n-id="pdfjs-attachments-button-label"
                    >Attachments</span
                  >
                </button>
                <button
                  id="viewLayers"
                  class="toolbarButton"
                  title="Show Layers (double-click to reset all layers to the default state)"
                  tabindex="5"
                  data-l10n-id="pdfjs-layers-button"
                  role="radio"
                  aria-checked="false"
                  aria-controls="layersView"
                  onclick="show()"
                >
                  <span data-l10n-id="pdfjs-layers-button-label">Layers</span>
                </button>

                <button
                  id="subPage"
                  class="toolbarButton"
                  title="Show Layers (double-click to reset all layers to the default state)"
                  tabindex="5"
                  data-l10n-id="pdfjs-layers-button"
                  role="radio"
                  aria-checked="false"
                  aria-controls="layersView"
                  onclick="showSubPage()"
                >
                  <span data-l10n-id="pdfjs-layers-button-label">Sub Page</span>
                </button>
              </div>
            </div>

            <div id="toolbarSidebarRight">
              <div id="outlineOptionsContainer">
                <div class="verticalToolbarSeparator"></div>

                <button
                  id="currentOutlineItem"
                  class="toolbarButton"
                  disabled="disabled"
                  title="Find Current Outline Item"
                  tabindex="6"
                  data-l10n-id="pdfjs-current-outline-item-button"
                >
                  <span data-l10n-id="pdfjs-current-outline-item-button-label"
                    >Current Outline Item</span
                  >
                </button>
              </div>
            </div>
          </div>
          <div id="sidebarContent">
            <div id="thumbnailView"></div>
            <div id="outlineView" class="hidden"></div>
            <div id="attachmentsView" class="hidden"></div>
            <div id="layersView" class="hidden"></div>
            <div id="thumbnailSubPage" class="hidden"></div>
            <div id="thumbnailSubPage_generate" class="hidden"></div>
          </div>
          <div id="sidebarResizer"></div>
        </div>
        <!-- sidebarContainer -->

        <div id="mainContainer">
          <div class="findbar hidden doorHanger" id="findbar">
            <div id="findbarInputContainer">
              <span class="loadingInput end">
                <input
                  id="findInput"
                  class="toolbarField"
                  title="Find"
                  placeholder="Find in document…"
                  tabindex="91"
                  data-l10n-id="pdfjs-find-input"
                  aria-invalid="false"
                />
              </span>
              <div class="splitToolbarButton">
                <button
                  id="findPrevious"
                  class="toolbarButton"
                  title="Find the previous occurrence of the phrase"
                  tabindex="92"
                  data-l10n-id="pdfjs-find-previous-button"
                >
                  <span data-l10n-id="pdfjs-find-previous-button-label"
                    >Previous</span
                  >
                </button>
                <div class="splitToolbarButtonSeparator"></div>
                <button
                  id="findNext"
                  class="toolbarButton"
                  title="Find the next occurrence of the phrase"
                  tabindex="93"
                  data-l10n-id="pdfjs-find-next-button"
                >
                  <span data-l10n-id="pdfjs-find-next-button-label">Next</span>
                </button>
              </div>
            </div>

            <div id="findbarOptionsOneContainer">
              <input
                type="checkbox"
                id="findHighlightAll"
                class="toolbarField"
                tabindex="94"
              />
              <label
                for="findHighlightAll"
                class="toolbarLabel"
                data-l10n-id="pdfjs-find-highlight-checkbox"
                >Highlight All</label
              >
              <input
                type="checkbox"
                id="findMatchCase"
                class="toolbarField"
                tabindex="95"
              />
              <label
                for="findMatchCase"
                class="toolbarLabel"
                data-l10n-id="pdfjs-find-match-case-checkbox-label"
                >Match Case</label
              >
            </div>
            <div id="findbarOptionsTwoContainer">
              <input
                type="checkbox"
                id="findMatchDiacritics"
                class="toolbarField"
                tabindex="96"
              />
              <label
                for="findMatchDiacritics"
                class="toolbarLabel"
                data-l10n-id="pdfjs-find-match-diacritics-checkbox-label"
                >Match Diacritics</label
              >
              <input
                type="checkbox"
                id="findEntireWord"
                class="toolbarField"
                tabindex="97"
              />
              <label
                for="findEntireWord"
                class="toolbarLabel"
                data-l10n-id="pdfjs-find-entire-word-checkbox-label"
                >Whole Words</label
              >
            </div>

            <div id="findbarMessageContainer" aria-live="polite">
              <span id="findResultsCount" class="toolbarLabel"></span>
              <span id="findMsg" class="toolbarLabel"></span>
            </div>
          </div>
          <!-- findbar -->

          <div
            class="editorParamsToolbar hidden doorHangerRight"
            id="editorHighlightParamsToolbar"
          >
            <div
              id="highlightParamsToolbarContainer"
              class="editorParamsToolbarContainer"
            >
              <div id="editorHighlightColorPicker" class="colorPicker">
                <span
                  id="highlightColorPickerLabel"
                  class="editorParamsLabel"
                  data-l10n-id="pdfjs-editor-highlight-colorpicker-label"
                  >Highlight color</span
                >
              </div>
              <div id="editorHighlightThickness">
                <label
                  for="editorFreeHighlightThickness"
                  class="editorParamsLabel"
                  data-l10n-id="pdfjs-editor-free-highlight-thickness-input"
                  >Thickness</label
                >
                <div class="thicknessPicker">
                  <input
                    type="range"
                    id="editorFreeHighlightThickness"
                    class="editorParamsSlider"
                    data-l10n-id="pdfjs-editor-free-highlight-thickness-title"
                    value="12"
                    min="8"
                    max="24"
                    step="1"
                    tabindex="101"
                  />
                </div>
              </div>
              <div id="editorHighlightVisibility">
                <div class="divider"></div>
                <div class="toggler">
                  <label
                    for="editorHighlightShowAll"
                    class="editorParamsLabel"
                    data-l10n-id="pdfjs-editor-highlight-show-all-button-label"
                    >Show all</label
                  >
                  <button
                    id="editorHighlightShowAll"
                    class="toggle-button"
                    data-l10n-id="pdfjs-editor-highlight-show-all-button"
                    aria-pressed="true"
                    tabindex="102"
                  ></button>
                </div>
              </div>
            </div>
          </div>

          <div
            class="editorParamsToolbar hidden doorHangerRight"
            id="editorFreeTextParamsToolbar"
          >
            <div class="editorParamsToolbarContainer">
              <div class="editorParamsSetter">
                <label
                  for="editorFreeTextColor"
                  class="editorParamsLabel"
                  data-l10n-id="pdfjs-editor-free-text-color-input"
                  >Color</label
                >
                <input
                  type="color"
                  id="editorFreeTextColor"
                  class="editorParamsColor"
                  tabindex="103"
                />
              </div>
              <div class="editorParamsSetter">
                <label
                  for="editorFreeTextFontSize"
                  class="editorParamsLabel"
                  data-l10n-id="pdfjs-editor-free-text-size-input"
                  >Size</label
                >
                <input
                  type="range"
                  id="editorFreeTextFontSize"
                  class="editorParamsSlider"
                  value="10"
                  min="5"
                  max="100"
                  step="1"
                  tabindex="104"
                />
              </div>
            </div>
          </div>

          <div
            class="editorParamsToolbar hidden doorHangerRight"
            id="editorInkParamsToolbar"
          >
            <div class="editorParamsToolbarContainer">
              <div class="editorParamsSetter">
                <label
                  for="editorInkColor"
                  class="editorParamsLabel"
                  data-l10n-id="pdfjs-editor-ink-color-input"
                  >Color</label
                >
                <input
                  type="color"
                  id="editorInkColor"
                  class="editorParamsColor"
                  tabindex="105"
                />
              </div>
              <div class="editorParamsSetter">
                <label
                  for="editorInkThickness"
                  class="editorParamsLabel"
                  data-l10n-id="pdfjs-editor-ink-thickness-input"
                  >Thickness</label
                >
                <input
                  type="range"
                  id="editorInkThickness"
                  class="editorParamsSlider"
                  value="1"
                  min="1"
                  max="20"
                  step="1"
                  tabindex="106"
                />
              </div>
              <div class="editorParamsSetter">
                <label
                  for="editorInkOpacity"
                  class="editorParamsLabel"
                  data-l10n-id="pdfjs-editor-ink-opacity-input"
                  >Opacity</label
                >
                <input
                  type="range"
                  id="editorInkOpacity"
                  class="editorParamsSlider"
                  value="100"
                  min="1"
                  max="100"
                  step="1"
                  tabindex="107"
                />
              </div>
            </div>
          </div>

          <div
            class="editorParamsToolbar hidden doorHangerRight"
            id="editorStampParamsToolbar"
          >
            <div class="editorParamsToolbarContainer">
              <button
                id="editorStampAddImage"
                class="secondaryToolbarButton"
                title="Add image"
                tabindex="108"
                data-l10n-id="pdfjs-editor-stamp-add-image-button"
              >
                <span
                  class="editorParamsLabel"
                  data-l10n-id="pdfjs-editor-stamp-add-image-button-label"
                  >Add image</span
                >
              </button>
            </div>
          </div>

          <div
            id="secondaryToolbar"
            class="secondaryToolbar hidden doorHangerRight"
          >
            <div id="secondaryToolbarButtonContainer">
              <button
                id="secondaryOpenFile"
                class="secondaryToolbarButton"
                title="Open File"
                tabindex="51"
                data-l10n-id="pdfjs-open-file-button"
              >
                <span data-l10n-id="pdfjs-open-file-button-label">Open</span>
              </button>

              <button
                id="secondaryPrint"
                class="secondaryToolbarButton visibleMediumView"
                title="Print"
                tabindex="52"
                data-l10n-id="pdfjs-print-button"
              >
                <span data-l10n-id="pdfjs-print-button-label">Print</span>
              </button>

              <button
                id="secondaryDownload"
                class="secondaryToolbarButton visibleMediumView"
                title="Save"
                tabindex="53"
                data-l10n-id="pdfjs-save-button"
              >
                <span data-l10n-id="pdfjs-save-button-label">Save</span>
              </button>

              <div class="horizontalToolbarSeparator"></div>

              <button
                id="presentationMode"
                class="secondaryToolbarButton"
                title="Switch to Presentation Mode"
                tabindex="54"
                data-l10n-id="pdfjs-presentation-mode-button"
              >
                <span data-l10n-id="pdfjs-presentation-mode-button-label"
                  >Presentation Mode</span
                >
              </button>

              <a
                href="#"
                id="viewBookmark"
                class="secondaryToolbarButton"
                title="Current Page (View URL from Current Page)"
                tabindex="55"
                data-l10n-id="pdfjs-bookmark-button"
              >
                <span data-l10n-id="pdfjs-bookmark-button-label"
                  >Current Page</span
                >
              </a>

              <div
                id="viewBookmarkSeparator"
                class="horizontalToolbarSeparator"
              ></div>

              <button
                id="firstPage"
                class="secondaryToolbarButton"
                title="Go to First Page"
                tabindex="56"
                data-l10n-id="pdfjs-first-page-button"
              >
                <span data-l10n-id="pdfjs-first-page-button-label"
                  >Go to First Page</span
                >
              </button>
              <button
                id="lastPage"
                class="secondaryToolbarButton"
                title="Go to Last Page"
                tabindex="57"
                data-l10n-id="pdfjs-last-page-button"
              >
                <span data-l10n-id="pdfjs-last-page-button-label"
                  >Go to Last Page</span
                >
              </button>

              <div class="horizontalToolbarSeparator"></div>

              <button
                id="pageRotateCw"
                class="secondaryToolbarButton"
                title="Rotate Clockwise"
                tabindex="58"
                data-l10n-id="pdfjs-page-rotate-cw-button"
              >
                <span data-l10n-id="pdfjs-page-rotate-cw-button-label"
                  >Rotate Clockwise</span
                >
              </button>
              <button
                id="pageRotateCcw"
                class="secondaryToolbarButton"
                title="Rotate Counterclockwise"
                tabindex="59"
                data-l10n-id="pdfjs-page-rotate-ccw-button"
              >
                <span data-l10n-id="pdfjs-page-rotate-ccw-button-label"
                  >Rotate Counterclockwise</span
                >
              </button>

              <div class="horizontalToolbarSeparator"></div>

              <div id="cursorToolButtons" role="radiogroup">
                <button
                  id="cursorSelectTool"
                  class="secondaryToolbarButton toggled"
                  title="Enable Text Selection Tool"
                  tabindex="60"
                  data-l10n-id="pdfjs-cursor-text-select-tool-button"
                  role="radio"
                  aria-checked="true"
                >
                  <span
                    data-l10n-id="pdfjs-cursor-text-select-tool-button-label"
                    >Text Selection Tool</span
                  >
                </button>
                <button
                  id="cursorHandTool"
                  class="secondaryToolbarButton"
                  title="Enable Hand Tool"
                  tabindex="61"
                  data-l10n-id="pdfjs-cursor-hand-tool-button"
                  role="radio"
                  aria-checked="false"
                >
                  <span data-l10n-id="pdfjs-cursor-hand-tool-button-label"
                    >Hand Tool</span
                  >
                </button>
              </div>

              <div class="horizontalToolbarSeparator"></div>

              <div id="scrollModeButtons" role="radiogroup">
                <button
                  id="scrollPage"
                  class="secondaryToolbarButton"
                  title="Use Page Scrolling"
                  tabindex="62"
                  data-l10n-id="pdfjs-scroll-page-button"
                  role="radio"
                  aria-checked="false"
                >
                  <span data-l10n-id="pdfjs-scroll-page-button-label"
                    >Page Scrolling</span
                  >
                </button>
                <button
                  id="scrollVertical"
                  class="secondaryToolbarButton toggled"
                  title="Use Vertical Scrolling"
                  tabindex="63"
                  data-l10n-id="pdfjs-scroll-vertical-button"
                  role="radio"
                  aria-checked="true"
                >
                  <span data-l10n-id="pdfjs-scroll-vertical-button-label"
                    >Vertical Scrolling</span
                  >
                </button>
                <button
                  id="scrollHorizontal"
                  class="secondaryToolbarButton"
                  title="Use Horizontal Scrolling"
                  tabindex="64"
                  data-l10n-id="pdfjs-scroll-horizontal-button"
                  role="radio"
                  aria-checked="false"
                >
                  <span data-l10n-id="pdfjs-scroll-horizontal-button-label"
                    >Horizontal Scrolling</span
                  >
                </button>
                <button
                  id="scrollWrapped"
                  class="secondaryToolbarButton"
                  title="Use Wrapped Scrolling"
                  tabindex="65"
                  data-l10n-id="pdfjs-scroll-wrapped-button"
                  role="radio"
                  aria-checked="false"
                >
                  <span data-l10n-id="pdfjs-scroll-wrapped-button-label"
                    >Wrapped Scrolling</span
                  >
                </button>
              </div>

              <div class="horizontalToolbarSeparator"></div>

              <div id="spreadModeButtons" role="radiogroup">
                <button
                  id="spreadNone"
                  class="secondaryToolbarButton toggled"
                  title="Do not join page spreads"
                  tabindex="66"
                  data-l10n-id="pdfjs-spread-none-button"
                  role="radio"
                  aria-checked="true"
                >
                  <span data-l10n-id="pdfjs-spread-none-button-label"
                    >No Spreads</span
                  >
                </button>
                <button
                  id="spreadOdd"
                  class="secondaryToolbarButton"
                  title="Join page spreads starting with odd-numbered pages"
                  tabindex="67"
                  data-l10n-id="pdfjs-spread-odd-button"
                  role="radio"
                  aria-checked="false"
                >
                  <span data-l10n-id="pdfjs-spread-odd-button-label"
                    >Odd Spreads</span
                  >
                </button>
                <button
                  id="spreadEven"
                  class="secondaryToolbarButton"
                  title="Join page spreads starting with even-numbered pages"
                  tabindex="68"
                  data-l10n-id="pdfjs-spread-even-button"
                  role="radio"
                  aria-checked="false"
                >
                  <span data-l10n-id="pdfjs-spread-even-button-label"
                    >Even Spreads</span
                  >
                </button>
              </div>

              <div class="horizontalToolbarSeparator"></div>

              <button
                id="documentProperties"
                class="secondaryToolbarButton"
                title="Document Properties…"
                tabindex="69"
                data-l10n-id="pdfjs-document-properties-button"
                aria-controls="documentPropertiesDialog"
              >
                <span data-l10n-id="pdfjs-document-properties-button-label"
                  >Document Properties…</span
                >
              </button>
            </div>
          </div>
          <!-- secondaryToolbar -->

          <div class="toolbar">
            <div id="toolbarContainer">
              <div id="toolbarViewer">
                <div id="toolbarViewerLeft">
                  <button
                    id="sidebarToggle"
                    class="toolbarButton"
                    title="Toggle Sidebar"
                    tabindex="11"
                    data-l10n-id="pdfjs-toggle-sidebar-button"
                    aria-expanded="false"
                    aria-controls="sidebarContainer"
                  >
                    <span data-l10n-id="pdfjs-toggle-sidebar-button-label"
                      >Toggle Sidebar</span
                    >
                  </button>
                  <div class="toolbarButtonSpacer"></div>
                  <button
                    id="viewFind"
                    class="toolbarButton"
                    title="Find in Document"
                    tabindex="12"
                    data-l10n-id="pdfjs-findbar-button"
                    aria-expanded="false"
                    aria-controls="findbar"
                  >
                    <span data-l10n-id="pdfjs-findbar-button-label">Find</span>
                  </button>
                  <div class="splitToolbarButton hiddenSmallView">
                    <button
                      class="toolbarButton"
                      title="Previous Page"
                      id="previous"
                      tabindex="13"
                      data-l10n-id="pdfjs-previous-button"
                    >
                      <span data-l10n-id="pdfjs-previous-button-label"
                        >Previous</span
                      >
                    </button>
                    <div class="splitToolbarButtonSeparator"></div>
                    <button
                      class="toolbarButton"
                      title="Next Page"
                      id="next"
                      tabindex="14"
                      data-l10n-id="pdfjs-next-button"
                    >
                      <span data-l10n-id="pdfjs-next-button-label">Next</span>
                    </button>
                  </div>
                  <span class="loadingInput start">
                    <input
                      type="number"
                      id="pageNumber"
                      class="toolbarField"
                      title="Page"
                      value="1"
                      min="1"
                      tabindex="15"
                      data-l10n-id="pdfjs-page-input"
                      autocomplete="off"
                    />
                  </span>
                  <span id="numPages" class="toolbarLabel"></span>
                </div>
                <div id="toolbarViewerRight">
                  <div
                    id="editorModeButtons"
                    class="splitToolbarButton toggled"
                    role="radiogroup"
                  >
                    <button
                      id="editorHighlight"
                      class="toolbarButton"
                      hidden="true"
                      disabled="disabled"
                      title="Highlight"
                      role="radio"
                      aria-checked="false"
                      aria-controls="editorHighlightParamsToolbar"
                      tabindex="31"
                      data-l10n-id="pdfjs-editor-highlight-button"
                    >
                      <span data-l10n-id="pdfjs-editor-highlight-button-label"
                        >Highlight</span
                      >
                    </button>
                    <button
                      id="editorFreeText"
                      class="toolbarButton"
                      disabled="disabled"
                      title="Text"
                      role="radio"
                      aria-checked="false"
                      aria-controls="editorFreeTextParamsToolbar"
                      tabindex="32"
                      data-l10n-id="pdfjs-editor-free-text-button"
                    >
                      <span data-l10n-id="pdfjs-editor-free-text-button-label"
                        >Text</span
                      >
                    </button>
                    <button
                      id="editorInk"
                      class="toolbarButton"
                      disabled="disabled"
                      title="Draw"
                      role="radio"
                      aria-checked="false"
                      aria-controls="editorInkParamsToolbar"
                      tabindex="33"
                      data-l10n-id="pdfjs-editor-ink-button"
                    >
                      <span data-l10n-id="pdfjs-editor-ink-button-label"
                        >Draw</span
                      >
                    </button>
                    <button
                      id="editorStamp"
                      class="toolbarButton hidden"
                      disabled="disabled"
                      title="Add or edit images"
                      role="radio"
                      aria-checked="false"
                      aria-controls="editorStampParamsToolbar"
                      tabindex="34"
                      data-l10n-id="pdfjs-editor-stamp-button"
                    >
                      <span data-l10n-id="pdfjs-editor-stamp-button-label"
                        >Add or edit images</span
                      >
                    </button>
                  </div>

                  <div
                    id="editorModeSeparator"
                    class="verticalToolbarSeparator"
                  ></div>

                  <button
                    id="print"
                    class="toolbarButton hiddenMediumView"
                    title="Print"
                    tabindex="41"
                    data-l10n-id="pdfjs-print-button"
                  >
                    <span data-l10n-id="pdfjs-print-button-label">Print</span>
                  </button>

                  <button
                    id="download"
                    class="toolbarButton hiddenMediumView"
                    title="Save"
                    tabindex="42"
                    data-l10n-id="pdfjs-save-button"
                  >
                    <span data-l10n-id="pdfjs-save-button-label">Save</span>
                  </button>

                  <div class="verticalToolbarSeparator hiddenMediumView"></div>

                  <button
                    id="secondaryToolbarToggle"
                    class="toolbarButton"
                    title="Tools"
                    tabindex="43"
                    data-l10n-id="pdfjs-tools-button"
                    aria-expanded="false"
                    aria-controls="secondaryToolbar"
                  >
                    <span data-l10n-id="pdfjs-tools-button-label">Tools</span>
                  </button>
                </div>
                <div id="toolbarViewerMiddle">
                  <div class="splitToolbarButton">
                    <button
                      id="zoomOut"
                      class="toolbarButton"
                      title="Zoom Out"
                      tabindex="21"
                      data-l10n-id="pdfjs-zoom-out-button"
                    >
                      <span data-l10n-id="pdfjs-zoom-out-button-label"
                        >Zoom Out</span
                      >
                    </button>
                    <div class="splitToolbarButtonSeparator"></div>
                    <button
                      id="zoomIn"
                      class="toolbarButton"
                      title="Zoom In"
                      tabindex="22"
                      data-l10n-id="pdfjs-zoom-in-button"
                    >
                      <span data-l10n-id="pdfjs-zoom-in-button-label"
                        >Zoom In</span
                      >
                    </button>
                  </div>
                  <span id="scaleSelectContainer" class="dropdownToolbarButton">
                    <select
                      id="scaleSelect"
                      title="Zoom"
                      tabindex="23"
                      data-l10n-id="pdfjs-zoom-select"
                    >
                      <option
                        id="pageAutoOption"
                        title=""
                        value="auto"
                        selected="selected"
                        data-l10n-id="pdfjs-page-scale-auto"
                      >
                        Automatic Zoom
                      </option>
                      <option
                        id="pageActualOption"
                        title=""
                        value="page-actual"
                        data-l10n-id="pdfjs-page-scale-actual"
                      >
                        Actual Size
                      </option>
                      <option
                        id="pageFitOption"
                        title=""
                        value="page-fit"
                        data-l10n-id="pdfjs-page-scale-fit"
                      >
                        Page Fit
                      </option>
                      <option
                        id="pageWidthOption"
                        title=""
                        value="page-width"
                        data-l10n-id="pdfjs-page-scale-width"
                      >
                        Page Width
                      </option>
                      <option
                        id="customScaleOption"
                        title=""
                        value="custom"
                        disabled="disabled"
                        hidden="true"
                        data-l10n-id="pdfjs-page-scale-percent"
                        data-l10n-args='{ "scale": 0 }'
                      >
                        0%
                      </option>
                      <option
                        title=""
                        value="0.5"
                        data-l10n-id="pdfjs-page-scale-percent"
                        data-l10n-args='{ "scale": 50 }'
                      >
                        50%
                      </option>
                      <option
                        title=""
                        value="0.75"
                        data-l10n-id="pdfjs-page-scale-percent"
                        data-l10n-args='{ "scale": 75 }'
                      >
                        75%
                      </option>
                      <option
                        title=""
                        value="1"
                        data-l10n-id="pdfjs-page-scale-percent"
                        data-l10n-args='{ "scale": 100 }'
                      >
                        100%
                      </option>
                      <option
                        title=""
                        value="1.25"
                        data-l10n-id="pdfjs-page-scale-percent"
                        data-l10n-args='{ "scale": 125 }'
                      >
                        125%
                      </option>
                      <option
                        title=""
                        value="1.5"
                        data-l10n-id="pdfjs-page-scale-percent"
                        data-l10n-args='{ "scale": 150 }'
                      >
                        150%
                      </option>
                      <option
                        title=""
                        value="2"
                        data-l10n-id="pdfjs-page-scale-percent"
                        data-l10n-args='{ "scale": 200 }'
                      >
                        200%
                      </option>
                      <option
                        title=""
                        value="3"
                        data-l10n-id="pdfjs-page-scale-percent"
                        data-l10n-args='{ "scale": 300 }'
                      >
                        300%
                      </option>
                      <option
                        title=""
                        value="4"
                        data-l10n-id="pdfjs-page-scale-percent"
                        data-l10n-args='{ "scale": 400 }'
                      >
                        400%
                      </option>
                    </select>
                  </span>
                </div>
              </div>
              <div id="loadingBar">
                <div class="progress">
                  <div class="glimmer"></div>
                </div>
              </div>
            </div>
          </div>

          <div id="viewerContainer" tabindex="0">
            <div id="viewer" class="pdfViewer"></div>
          </div>
        </div>
        <!-- mainContainer -->

        <div id="dialogContainer">
          <dialog id="passwordDialog">
            <div class="row">
              <label
                for="password"
                id="passwordText"
                data-l10n-id="pdfjs-password-label"
                >Enter the password to open this PDF file:</label
              >
            </div>
            <div class="row">
              <input type="password" id="password" class="toolbarField" />
            </div>
            <div class="buttonRow">
              <button id="passwordCancel" class="dialogButton">
                <span data-l10n-id="pdfjs-password-cancel-button">Cancel</span>
              </button>
              <button id="passwordSubmit" class="dialogButton">
                <span data-l10n-id="pdfjs-password-ok-button">OK</span>
              </button>
            </div>
          </dialog>
          <dialog id="documentPropertiesDialog">
            <div class="row">
              <span
                id="fileNameLabel"
                data-l10n-id="pdfjs-document-properties-file-name"
                >File name:</span
              >
              <p id="fileNameField" aria-labelledby="fileNameLabel">-</p>
            </div>
            <div class="row">
              <span
                id="fileSizeLabel"
                data-l10n-id="pdfjs-document-properties-file-size"
                >File size:</span
              >
              <p id="fileSizeField" aria-labelledby="fileSizeLabel">-</p>
            </div>
            <div class="separator"></div>
            <div class="row">
              <span
                id="titleLabel"
                data-l10n-id="pdfjs-document-properties-title"
                >Title:</span
              >
              <p id="titleField" aria-labelledby="titleLabel">-</p>
            </div>
            <div class="row">
              <span
                id="authorLabel"
                data-l10n-id="pdfjs-document-properties-author"
                >Author:</span
              >
              <p id="authorField" aria-labelledby="authorLabel">-</p>
            </div>
            <div class="row">
              <span
                id="subjectLabel"
                data-l10n-id="pdfjs-document-properties-subject"
                >Subject:</span
              >
              <p id="subjectField" aria-labelledby="subjectLabel">-</p>
            </div>
            <div class="row">
              <span
                id="keywordsLabel"
                data-l10n-id="pdfjs-document-properties-keywords"
                >Keywords:</span
              >
              <p id="keywordsField" aria-labelledby="keywordsLabel">-</p>
            </div>
            <div class="row">
              <span
                id="creationDateLabel"
                data-l10n-id="pdfjs-document-properties-creation-date"
                >Creation Date:</span
              >
              <p id="creationDateField" aria-labelledby="creationDateLabel">
                -
              </p>
            </div>
            <div class="row">
              <span
                id="modificationDateLabel"
                data-l10n-id="pdfjs-document-properties-modification-date"
                >Modification Date:</span
              >
              <p
                id="modificationDateField"
                aria-labelledby="modificationDateLabel"
              >
                -
              </p>
            </div>
            <div class="row">
              <span
                id="creatorLabel"
                data-l10n-id="pdfjs-document-properties-creator"
                >Creator:</span
              >
              <p id="creatorField" aria-labelledby="creatorLabel">-</p>
            </div>
            <div class="separator"></div>
            <div class="row">
              <span
                id="producerLabel"
                data-l10n-id="pdfjs-document-properties-producer"
                >PDF Producer:</span
              >
              <p id="producerField" aria-labelledby="producerLabel">-</p>
            </div>
            <div class="row">
              <span
                id="versionLabel"
                data-l10n-id="pdfjs-document-properties-version"
                >PDF Version:</span
              >
              <p id="versionField" aria-labelledby="versionLabel">-</p>
            </div>
            <div class="row">
              <span
                id="pageCountLabel"
                data-l10n-id="pdfjs-document-properties-page-count"
                >Page Count:</span
              >
              <p id="pageCountField" aria-labelledby="pageCountLabel">-</p>
            </div>
            <div class="row">
              <span
                id="pageSizeLabel"
                data-l10n-id="pdfjs-document-properties-page-size"
                >Page Size:</span
              >
              <p id="pageSizeField" aria-labelledby="pageSizeLabel">-</p>
            </div>
            <div class="separator"></div>
            <div class="row">
              <span
                id="linearizedLabel"
                data-l10n-id="pdfjs-document-properties-linearized"
                >Fast Web View:</span
              >
              <p id="linearizedField" aria-labelledby="linearizedLabel">-</p>
            </div>
            <div class="buttonRow">
              <button id="documentPropertiesClose" class="dialogButton">
                <span data-l10n-id="pdfjs-document-properties-close-button"
                  >Close</span
                >
              </button>
            </div>
          </dialog>
          <dialog
            class="dialog altText"
            id="altTextDialog"
            aria-labelledby="dialogLabel"
            aria-describedby="dialogDescription"
          >
            <div id="altTextContainer" class="mainContainer">
              <div id="overallDescription">
                <span
                  id="dialogLabel"
                  data-l10n-id="pdfjs-editor-alt-text-dialog-label"
                  class="title"
                  >Choose an option</span
                >
                <span
                  id="dialogDescription"
                  data-l10n-id="pdfjs-editor-alt-text-dialog-description"
                >
                  Alt text (alternative text) helps when people can’t see the
                  image or when it doesn’t load.
                </span>
              </div>
              <div id="addDescription">
                <div class="radio">
                  <div class="radioButton">
                    <input
                      type="radio"
                      id="descriptionButton"
                      name="altTextOption"
                      tabindex="0"
                      aria-describedby="descriptionAreaLabel"
                      checked
                    />
                    <label
                      for="descriptionButton"
                      data-l10n-id="pdfjs-editor-alt-text-add-description-label"
                      >Add a description</label
                    >
                  </div>
                  <div class="radioLabel">
                    <span
                      id="descriptionAreaLabel"
                      data-l10n-id="pdfjs-editor-alt-text-add-description-description"
                    >
                      Aim for 1-2 sentences that describe the subject, setting,
                      or actions.
                    </span>
                  </div>
                </div>
                <div class="descriptionArea">
                  <textarea
                    id="descriptionTextarea"
                    placeholder="For example, “A young man sits down at a table to eat a meal”"
                    aria-labelledby="descriptionAreaLabel"
                    data-l10n-id="pdfjs-editor-alt-text-textarea"
                    tabindex="0"
                  ></textarea>
                </div>
              </div>
              <div id="markAsDecorative">
                <div class="radio">
                  <div class="radioButton">
                    <input
                      type="radio"
                      id="decorativeButton"
                      name="altTextOption"
                      aria-describedby="decorativeLabel"
                    />
                    <label
                      for="decorativeButton"
                      data-l10n-id="pdfjs-editor-alt-text-mark-decorative-label"
                      >Mark as decorative</label
                    >
                  </div>
                  <div class="radioLabel">
                    <span
                      id="decorativeLabel"
                      data-l10n-id="pdfjs-editor-alt-text-mark-decorative-description"
                    >
                      This is used for ornamental images, like borders or
                      watermarks.
                    </span>
                  </div>
                </div>
              </div>
              <div id="buttons">
                <button id="altTextCancel" class="secondaryButton" tabindex="0">
                  <span data-l10n-id="pdfjs-editor-alt-text-cancel-button"
                    >Cancel</span
                  >
                </button>
                <button id="altTextSave" class="primaryButton" tabindex="0">
                  <span data-l10n-id="pdfjs-editor-alt-text-save-button"
                    >Save</span
                  >
                </button>
              </div>
            </div>
          </dialog>
          <dialog id="printServiceDialog" style="min-width: 200px">
            <div class="row">
              <span data-l10n-id="pdfjs-print-progress-message"
                >Preparing document for printing…</span
              >
            </div>
            <div class="row">
              <progress value="0" max="100"></progress>
              <span
                data-l10n-id="pdfjs-print-progress-percent"
                data-l10n-args='{ "progress": 0 }'
                class="relative-progress"
                >0%</span
              >
            </div>
            <div class="buttonRow">
              <button id="printCancel" class="dialogButton">
                <span data-l10n-id="pdfjs-print-progress-close-button"
                  >Cancel</span
                >
              </button>
            </div>
          </dialog>
        </div>
        <!-- dialogContainer -->
      </div>

      <!-- outerContainer -->
      <div id="printContainer"></div>

      <div
        class="modal fade"
        id="staticBackdrop"
        data-bs-backdrop="static"
        data-bs-keyboard="false"
        tabindex="-1"
        aria-labelledby="staticBackdropLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
                onclick="removeSelection()"
              ></button>
            </div>
            <div class="modal-body"></div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
                onclick="removeSelection()"
              >
                Close
              </button>
              <button type="button" class="btn btn-primary" onclick="add()">
                Add
              </button>
            </div>
          </div>
        </div>
      </div>

      <div
        class="modal fade"
        id="compare-question"
        data-bs-backdrop="static"
        data-bs-keyboard="false"
        tabindex="-1"
        aria-labelledby="staticBackdropLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body"></div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Close
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div
      class="page-1"
      style="
        flex: 1;
        background-color: white;
        padding: 10px;
        margin: 10px;
        position: relative;
      "
    >
      <div id="CsvContainer">
        <div
          id="CsvContent"
          class="hide"
          style="
            max-height: 30%;
            min-height: 30%;
            overflow-x: auto;
            overflow-y: auto;
            margin: 10px;
          "
        >
          <div>Question: <span class="question"></span></div>
          <div>Answer: <span class="answer"></span></div>
        </div>
        <div id="navigate" class="hide">
          <div style="display: flex; justify-content: space-between">
            <div>
              <button style="padding: 3px" class="prev" onclick="prev()">
                Prev
              </button>
              <button style="padding: 3px" class="next" onclick="next()">
                Next
              </button>
            </div>
            <div>
              <button style="padding: 3px" class="check" onclick="check()">
                Check
              </button>
            </div>
          </div>
        </div>
      </div>

      <div id="your_choice">
        <button onclick="check_question()">Check question</button>
        <button onclick="view_log()">View Log</button>
      </div>
      <div style="margin: 5px">
        <input
          class="hidden"
          type="file"
          name="CsvFile"
          id="CsvFile"
          onchange="UploadCsvFile(event)"
          accept=".csv"
        />
      </div>
      <div id="selected" style="max-height: 55%; overflow-y: auto"></div>
      <div
        id="generate_selected"
        style="max-height: 55%; overflow-y: auto"
      ></div>

      <div id="view_log_selected" class="hidden">
        <button onclick="view_log_check_question()">
          View Log Check Question
        </button>
      </div>
      <div
        class="hidden"
        id="back"
        style="position: absolute; bottom: 10px; right: 0px; width: 100%"
      >
        <div style="display: flex; justify-content: space-evenly">
          <button class="button" onclick="backToSelected()">Back</button>
        </div>
      </div>

    </div>

    {% include "plot.html" %} {% include "compare.html" %} {% include "view_log_check_question.html" %}
    <script>
      var CsvData;
      var max;
      var index = 0;
      var min = 0;
      var isCheck = null;
      var log = null;
      var log_id = 0;
      var sub_chapter = null;
      var learning_outcome = null;

      function report_createStackedBarChart(labels, data, chart) {
        const ctx = document.getElementById(chart).getContext("2d");
        const datasets = [
          {
            label: "Level 1",
            data: data.map((d) => d[0]),
            backgroundColor: "rgba(255, 99, 132, 0.2)",
            borderColor: "rgba(255, 99, 132, 1)",
            borderWidth: 1,
          },
          {
            label: "Level 2",
            data: data.map((d) => d[1]),
            backgroundColor: "rgba(54, 162, 235, 0.2)",
            borderColor: "rgba(54, 162, 235, 1)",
            borderWidth: 1,
          },
          {
            label: "Level 3",
            data: data.map((d) => d[2]),
            backgroundColor: "rgba(75, 192, 192, 0.2)",
            borderColor: "rgba(75, 192, 192, 1)",
            borderWidth: 1,
          },
        ];

        new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: datasets,
          },
          options: {
            scales: {
              x: {
                stacked: true,
              },
              y: {
                stacked: true,
              },
            },
          },
        });
      }

      function selectSubChapter() {
        var Lo = $("#LO").val();
        var sub_chapter_body = $("#SC");
        sub_chapter_body.empty();
        var subchapters = sub_chapter[Lo];
        console.log(subchapters);
        for (var item in subchapters) {
          var option = `<option value="${item}">${subchapters[item]}</option>`;
          sub_chapter_body.append(option);
        }
      }

      function log_detail(log_id) {
        log_id = log_id;
        var raw = $("#raw_log");
        raw.empty();
        var text = JSON.stringify(log[log_id - 1], null, 2);
        raw.html(text);
        log_plot(log[log_id - 1].graph);
        log_ranking(log[log_id - 1].ranking_result);
        log_question_compare = log[log_id - 1].question_compare;
        console.log(log_question_compare);
        $("#log_check_question_detail").modal("show");
        $("#view_log_check_question").modal("hide");
      }

      function view_log_check_question() {
        $.ajax({
          url: "/getLog",
          type: "POST",
          success: function (response) {
            log = response.data;
            var tbody = $("#list_log");
            tbody.empty();
            for (var i = 0; i < log.length; i++) {
              var item = log[i];
              var question = item.question_input;
              var request =
                "id question: " +
                question.id +
                ", " +
                "Content: " +
                question.question_content +
                "Answer:" +
                question.ans;
              var tr = `<tr>
                          <td>${item.id_log}</td>
                          <td>${question.id}</td>
                          <td>${question.question_content} ...</td>
                          <td>${question.instruction} ...</td>
                          <td><button onclick=log_detail(${
                            item.id_log
                          })>Detail</button></td>
                        </tr>
              `;
              tbody.append(tr);
            }
          },
        });
        $("#view_log_check_question").modal("show");
      }

      function view_log() {
        isCheck = false;
        $('#back').removeClass("hidden")
        $('#your_choice').addClass('hidden')
        $('#view_log_selected').removeClass('hidden')
      }

      function back_to_list_log() {
        $("#log_check_question_detail").modal("hide");
        $("#view_log_check_question").modal("show");
      }

      function log_check_question_detail(log_id) {
        log_id = log_id;
        var raw = $("#raw_log");
        raw.empty();
        var text = JSON.stringify(log[log_id - 1], null, 2);
        raw.html(text);
        log_plot(log[log_id - 1].graph);
        log_ranking(log[log_id - 1].ranking_result);
        log_question_compare = log[log_id - 1].question_compare;
        console.log(log_question_compare);
        $("#log_check_question_detail").modal("show");
        $("#view_log_check_question").modal("hide");
      }

      function raw_log() {
        $("#raw_log").removeClass("hidden");
        $("#table_log").addClass("hidden");
      }

      function table_log() {
        $("#raw_log").addClass("hidden");
        $("#table_log").removeClass("hidden");
      }

      function check_question() {
        isCheck = true;
        $("#back").removeClass("hidden");
        $("#your_choice").addClass("hidden");
        $("#CsvFile").removeClass("hidden");
        $("#CsvContainer").removeClass("hidden");
      }

      function backToSelected() {
        isCheck = null;
        $("#selected").empty();
        $("#back").addClass("hidden");
        $("#your_choice").removeClass("hidden");
        $("#CsvFile").addClass("hidden");
        $("#CsvContainer").addClass("hidden");
        $("#thumbnailSubPage").addClass("hidden");
        $("#option").addClass("hidden");
        $('#view_log_selected').addClass('hidden')
      }

      function check() {
        var question = CsvData[index].question;
        question = question.replace(/\n/g, "</br>");
        var answer = CsvData[index].answer;
        var id = CsvData[index].id;
        var difficulty = CsvData[index].difficulty;

        var note_content = $(".question-" + CsvData[index].id);

        var notes = [];

        note_content.find(".note").each(function () {
          var note = $(this).find(".note-content").text();
          note = note.replace(/\n/g, " ");
          var page = $(this).find(".page").text();
          var note = {
            knowledge: note,
            page: page.trim().split(" ")[1].split(")")[0],
          };
          notes.push(note);
        });

        var data = {
          id: id,
          question: question,
          //answer: answer,
          //difficulty: difficulty,
          notes: notes,
        };

        var json_data = JSON.stringify(data);
        console.log(json_data);
        $.ajax({
          type: "POST",
          url: "/submit",
          data: { collectedData: json_data },
          success: function (response) {
            console.log(response);
            $(".page-1").each(function () {
              $(this).addClass("hidden");
            });

            $(".page-2").each(function () {
              $(this).removeClass("hidden");
            });

            plot()
            console.log(response.question_content);
            ranking(json_data);
          },
        });
      }
      var selectedText = "";
      var element_start, element_end;

      function highlightText() {
        console.log(element_start, element_end);
        var page = getPageNumber(element_start, element_end);
        var page_start = page[0];
        var page_end = page[1];
        var text = selectedText.split("\n");
        var span_start, span_end;
        element_start = $(element_start);
        element_end = $(element_end);

        addSubPage(page_start);

        console.log(text[text.length - 1]);

        if (element_start.attr("role") != "presentation") {
          if (element_start.hasClass("textLayer")) {
            element_start = element_start.parent();
          }
          element_start.find(".textLayer span").each(function () {
            if ($(this).text().includes(text[0])) {
              span_start = $(this);
              return false;
            }
          });
        } else {
          span_start = element_start;
          span_start.addClass("start");
        }
        if (element_end.attr("role") != "presentation") {
          if (element_end.hasClass("textLayer")) {
            element_end = element_end.parent();
          }
          var isFirst = false;
          var isStart_ = false;
          var max_length = 0;
          element_end.find(".textLayer span").each(function () {
            if ($(this).hasClass("start")) {
              isStart_ = true;
            }
            if (text[text.length - 1].includes($(this).text()) && isStart_) {
              isFirst = true;
            } else {
              if (isFirst && $(this).text().length > max_length) {
                span_end = $(this);
                max_length = $(this).text().length;
              }
            }
          });
        } else {
          span_end = element_end;
        }

        console.log(span_start, span_end);

        var new_content = "";
        var textSlice = textSplitStart(
          span_start.text().trim(),
          text[0].trim()
        );

        new_content +=
          span_start.text().split(textSlice)[0] == ""
            ? ""
            : "<span role='presentation' class='position-relative'>" +
              span_start.text().split(textSlice)[0] +
              "</span>";
        new_content +=
          "<span role='presentation' class='select position-relative'>" +
          textSlice +
          "</span>";
        new_content +=
          span_start.text().split(textSlice)[1] == ""
            ? ""
            : "<span role='presentation' class='position-relative'>" +
              span_start.text().split(textSlice)[1] +
              "</span>";

        span_start.html(new_content);

        if (span_start.text() !== span_end.text()) {
          new_content = "";
          textSlice = textSplitEnd(
            span_end.text().trim(),
            text[text.length - 1].trim()
          );

          new_content +=
            span_end.text().split(textSlice)[0] == ""
              ? ""
              : "<span role='presentation' class='position-relative'>" +
                span_end.text().split(textSlice)[0] +
                "</span>";
          new_content +=
            "<span role='presentation' class='select position-relative'>" +
            textSlice +
            "</span>";
          new_content +=
            span_end.text().split(textSlice)[1] == ""
              ? ""
              : "<span role='presentation' class='position-relative'>" +
                span_end.text().split(textSlice)[1] +
                "</span>";

          span_end.html(new_content);
        }

        span_end.addClass("end");

        var isStart = false;
        var isEnd = false;
        for (var i = page_start; i <= page_end; i++) {
          var spans = $('div[data-page-number="' + i + '"] .textLayer > span');
          spans.each(function () {
            var currentSpan = $(this)[0];
            if ($(this).hasClass("end") && currentSpan === span_end[0]) {
              isEnd = true;
            }

            if (isStart && !isEnd) {
              $(this).addClass("select");
            }

            if ($(this).hasClass("start") && currentSpan === span_start[0]) {
              isStart = true;
            }
          });
        }
      }

      function getSelectedText() {
        var selectedElement = [];
        var start, end;

        if (window.getSelection) {
          selectedText = window.getSelection().toString().trim();
          var selection = window.getSelection().getRangeAt(0);
          element_start = selection.startContainer.parentElement;
          element_end = selection.endContainer.parentElement;
          var page = getPageNumber(element_start, element_end);
          start = page[0];
          end = page[1];
        }
        if (selectedText !== "" && selectedElement) {
          var text = "";
          if (start == end || end == null) {
            text = " (page " + start + ")";
          } else {
            text = "(page " + start + "-" + end + ")";
          }

          var e = $(selectedElement).parent();
          var selected = $("<div>", {}).text(selectedText);
          var span = $("<span>", {
            class: "page",
          }).text(text);

          var modal = $("#staticBackdrop").modal("show");
          var modal_body = modal.find(".modal-body");
          modal_body.empty();
          modal_body.append(selected);
          modal_body.append(span);
        }
      }

      function textSplitStart(span_text, text_content) {
        console.log("-", span_text);
        console.log("-", text_content);
        if (span_text.includes(text_content)) {
          console.log("+", text_content);
          return text_content;
        } else {
          var index = 1;
          while (index < span_text.length + 2) {
            if (span_text.includes(text_content.slice(0, index))) {
              index = index + 1;
            } else {
              console.log("+", text_content.slice(0, index - 1));
              return text_content.slice(0, index - 1);
            }
          }
        }
      }

      function textSplitEnd(span_text, text_content) {
        console.log("-", span_text);
        console.log("-", text_content);
        if (text_content.includes(span_text)) {
          console.log("++", span_text);
          return span_text;
        } else {
          var index = span_text.length - 1;
          while (index > 0) {
            if (text_content.includes(span_text.slice(0, index))) {
              console.log("++", span_text.slice(0, index));
              return span_text.slice(0, index);
            } else {
              index = index - 1;
            }
          }
        }
      }

      function getPageNumber(start, end) {
        for (var x = 0; x < 4; x++) {
          if (start.getAttribute("data-page-number") == null) {
            start = start.parentElement;
          } else {
            start = start.getAttribute("data-page-number");
            break;
          }
        }

        for (var i = 0; i < 4; i++) {
          if (end.getAttribute("data-page-number") == null) {
            end = end.parentElement;
          } else {
            end = end.getAttribute("data-page-number");
            break;
          }
        }
        return [start, end];
      }

      function addSubPage(pageNumber) {
        var subPage = $('#thumbnailView a[href="#page=' + pageNumber + '"]');
        if (isCheck) {
          $("#thumbnailSubPage .question-" + CsvData[index].id).append(subPage);
        } else {
          $("#thumbnailSubPage_generate").append(subPage);
        }
      }

      function add() {
        var selectedText = $("#staticBackdrop").find(".modal-body div").text();
        var page = $("#staticBackdrop").find(".modal-body span").text();
        var selected = $("<div>", {
          class: "note",
          css: {
            position: "relative", // Setting CSS properties using 'css' option
          },
        });

        var note_content = $("<span>", {
          text: selectedText,
          class: "note-content",
        });

        selected.append(note_content);

        var page_span = $("<span>", {
          class: "page",
        }).text(page);

        selected.append(page_span);

        var delete_span = $("<span>", {
          text: "x",
          css: {
            position: "absolute",
            top: "0px",
            right: "0px",
            padding: "2px",
            borderRadius: "50%",
            display: "flex",
            alignItems: "center",
            cursor: "pointer",
            width: "15px",
            height: "15px",
            color: "red",
          },
          on: {
            click: function () {
              $(this).parent().remove();
            },
          },
        });
        selected.append(delete_span);

        var csvContent = $("#CsvContent").text().trim();

        if (csvContent === "") {
          alert("Bạn cần có câu hỏi trước khi thêm các thông tin");
        } else {
          $("#staticBackdrop").modal("hide");
          if (isCheck) {
            $("#selected .question-" + CsvData[index].id).append(selected);
          } else {
            $("#generate_selected").append(selected);
          }
        }
        highlightText();
        removeSelection();
      }

      function removeSelection() {
        if (window.getSelection) {
          window.getSelection().removeAllRanges();
        } else if (document.selection) {
          document.selection.empty();
        }
      }

      function UploadCsvFile(event) {
        var formData = new FormData();
        var fileInput = event.target;
        if (fileInput.files.length === 0) {
          $("#CsvContent").text("Plesase select a CSV file");
          return;
        }

        formData.append("file", fileInput.files[0]);

        $.ajax({
          url: "/upload",
          type: "post",
          data: formData,
          contentType: false,
          processData: false,
          success: function (response) {
            console.log(response.data);
            if (response.success) {
              CsvData = response.data;
              console.log(CsvData);
              max = CsvData.length - 1;
              for (var i = 0; i <= max; i++) {
                var div = $("<div>", {
                  class: "hide question-" + CsvData[i].id,
                });
                $("#selected").append(div);
                div = $("<div>", {
                  class: "hide question-" + CsvData[i].id,
                });

                $("#thumbnailSubPage").append(div);
              }
              $("#navigate").removeClass("hide");
              $("#CsvContent").removeClass("hide");
              selectQuestion();
            } else {
              alert(response.message);
            }
          },
        });
      }

      function selectQuestion() {
        var question = CsvData[index].question;
        question = question.replace(/\n/g, "</br>");
        var answer = CsvData[index].answer;

        $("#CsvContent .question").html(question);
        $("#CsvContent .answer").html(answer);

        $("#selected > div").each(function () {
          $(this).addClass("hide");
        });

        $("#selected .question-" + CsvData[index].id).removeClass("hide");

        $("#thumbnailSubPage > div").each(function () {
          $(this).addClass("hide");
        });

        $("#thumbnailSubPage .question-" + CsvData[index].id).removeClass(
          "hide"
        );
      }

      function prev() {
        if (index > min) {
          index--;
        } else {
          index = max;
        }
        selectQuestion();
      }

      function next() {
        if (index < max) {
          index++;
        } else {
          index = min;
        }
        selectQuestion();
      }

      function UploadPdfFile(event) {
        var formData = new FormData();
        var fileInput = event.target;
        if (fileInput.files.length === 0) {
          alert("Please select a PDF file");
          return;
        }
        formData.append("file", fileInput.files[0]);

        $.ajax({
          url: "/Upload/PdfFile",
          type: "post",
          data: formData,
          contentType: false,
          processData: false,
          success: function (response) {
            if (response.success) {
              $("#viewer").empty();
              var binaryString = atob(response.data);
              var len = binaryString.length;
              var byteArray = new Uint8Array(len);
              for (var i = 0; i < len; i++) {
                byteArray[i] = binaryString.charCodeAt(i);
              }
              PDFViewerApplication.open({ data: byteArray });
            } else {
              alert(response.message);
            }
          },
        });
      }

      function hiddenThumbnail() {
        $("#sidebarContent > div").each(function () {
          $(this).addClass("hidden");
        });
      }

      function showSubPage() {
        hiddenThumbnail();
        if (isCheck) {
          $("#thumbnailSubPage").removeClass("hidden");
        } else {
          $("#thumbnailSubPage_generate").removeClass("hidden");
        }
      }

      function show() {
        hiddenThumbnail();
        $(this).removeClass("hidden");
      }

      var existingChart1 = null;
      var existingChart2 = null;
      var existingChart4 = null;

      function drawChart(ctx, labels, data, chartNumber) {
        if (chartNumber === 1 && existingChart1) {
          existingChart1.destroy();
        } else if (chartNumber === 2 && existingChart2) {
          existingChart2.destroy();
        } else if (chartNumber === 4 && existingChart4) {
          existingChart4.destroy();
        }

        a_new_Chart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Number of First Graph",
                data: data,
                backgroundColor: "rgba(75, 192, 192, 0.2)",
                borderColor: "rgba(75, 192, 192, 1)",
                borderWidth: 1,
              },
            ],
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        });
        if (chartNumber === 1) {
          existingChart1 = a_new_Chart;
        } else if (chartNumber === 2) {
          existingChart2 = a_new_Chart;
        } else if (chartNumber === 4) {
          existingChart4 = a_new_Chart;
        }
      }
      
      var existingStackedBarChart = null;
      function createStackedBarChart(labels, data) {
        const ctx = document.getElementById("chart3").getContext("2d");
        if (existingStackedBarChart) {
          existingStackedBarChart.destroy();
        }

        const datasets = [
          {
            label: "Level 1",
            data: data.map((d) => d[0]),
            backgroundColor: "rgba(255, 99, 132, 0.2)",
            borderColor: "rgba(255, 99, 132, 1)",
            borderWidth: 1,
          },
          {
            label: "Level 2",
            data: data.map((d) => d[1]),
            backgroundColor: "rgba(54, 162, 235, 0.2)",
            borderColor: "rgba(54, 162, 235, 1)",
            borderWidth: 1,
          },
          {
            label: "Level 3",
            data: data.map((d) => d[2]),
            backgroundColor: "rgba(75, 192, 192, 0.2)",
            borderColor: "rgba(75, 192, 192, 1)",
            borderWidth: 1,
          },
        ];

        existingStackedBarChart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: datasets,
          },
          options: {
            scales: {
              x: {
                stacked: true,
              },
              y: {
                stacked: true,
              },
            },
          },
        });
      }

      function plot() {
        $.ajax({
          url: "/data",
          method: "GET",
          success: function (response) {
            console.log(response);
            var ctx1 = document.getElementById("chart1").getContext("2d");
            var labels1 = response.chart1.learning_outcome;
            var data1 = response.chart1.number;
            drawChart(ctx1, labels1, data1, 1);

            var ctx2 = document.getElementById("chart2").getContext("2d");
            var labels2 = response.chart2.subchapter;
            var data2 = response.chart2.number;
            drawChart(ctx2, labels2, data2, 2);

            var labels3 = response.chart3.subchapter;
            var data3 = response.chart3.difficult_level;
            createStackedBarChart(labels3, data3);

            var ctx4 = document.getElementById("chart4").getContext("2d");
            var labels4 = response.chart4.spatial_match;
            var data4 = response.chart4.number;
            drawChart(ctx4, labels4, data4, 4);
          },
        });
      }

      function log_plot(data) {
        var xdata = JSON.stringify(data);
        console.log(xdata);
        $.ajax({
          url: "/formatDataChart",
          type: "POST",
          data: { data: xdata },
          success: function (response) {
            console.log(response);
            var ctx1 = document.getElementById("chart01").getContext("2d");
            var labels1 = response.chart1.learning_outcome;
            var data1 = response.chart1.number;
            drawChart(ctx1, labels1, data1, 1);

            var ctx2 = document.getElementById("chart02").getContext("2d");
            var labels2 = response.chart2.subchapter;
            var data2 = response.chart2.number;
            drawChart(ctx2, labels2, data2, 2);

            var labels3 = response.chart3.subchapter;
            var data3 = response.chart3.difficult_level;
            log_createStackedBarChart(labels3, data3);

            var ctx4 = document.getElementById("chart04").getContext("2d");
            var labels4 = response.chart4.spatial_match;
            var data4 = response.chart4.number;
            drawChart(ctx4, labels4, data4, 4);
          },
        });
      }

      function log_createStackedBarChart(labels, data) {
        const ctx = document.getElementById("chart03").getContext("2d");

        const datasets = [
          {
            label: "Level 1",
            data: data.map((d) => d[0]),
            backgroundColor: "rgba(255, 99, 132, 0.2)",
            borderColor: "rgba(255, 99, 132, 1)",
            borderWidth: 1,
          },
          {
            label: "Level 2",
            data: data.map((d) => d[1]),
            backgroundColor: "rgba(54, 162, 235, 0.2)",
            borderColor: "rgba(54, 162, 235, 1)",
            borderWidth: 1,
          },
          {
            label: "Level 3",
            data: data.map((d) => d[2]),
            backgroundColor: "rgba(75, 192, 192, 0.2)",
            borderColor: "rgba(75, 192, 192, 1)",
            borderWidth: 1,
          },
        ];

        new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: datasets,
          },
          options: {
            scales: {
              x: {
                stacked: true,
              },
              y: {
                stacked: true,
              },
            },
          },
        });
      }

      let question_compare;
      let log_question_compare;
      let result;

      function ranking(data_question) {
        $.ajax({
          url: "/submitquestion",
          type: "post",
          data: { collectedData: data_question },
          success: function (response) {
            const responseData = response.data;
            result = response.data;
            console.log(response.data);
            for (let i = 0; i < responseData.length; i++) {
              const question = responseData[i];
              const tr = `<tr>
                <td>${question[0]}</td>
                <td>${parseFloat(question[1]).toFixed(4)}</td>
                <td>${parseFloat(question[2]).toFixed(4)}</td>
                <td>${question[3]}</td>
                <td><button type="button" onclick="Compare(${question[0]})" style="padding: 5px">Check</button></td>
            </tr>`;
              $("#body").append(tr); // Append to a table body with id "body"
            }
            question_compare = response.question_compare;
            console.log(question_compare);
            $("#question").removeClass("hide");
          },
          error: function (xhr, status, error) {
            // Handle errors (e.g., show error message)
            console.error("Error:", error);
          },
        });
      }

      function log_ranking(data_question) {
        const responseData = data_question;
        for (let i = 0; i < responseData.length; i++) {
          const question = responseData[i];
          const tr = `<tr>
                          <td>${question[0]}</td>
                          <td>${parseFloat(question[1]).toFixed(4)}</td>
                          <td>${parseFloat(question[2]).toFixed(4)}</td>
                          <td>${question[3]}</td>
                          <td><button type="button" onclick="log_compare(${question[0]})" style="padding: 5px">Check</button></td>
                      </tr>`;
          $("#log_body").append(tr); // Append to a table body with id "body"
        }
        //question_compare = response.question_compare;
        //console.log(question_compare);
        $("#log_question").removeClass("hide");
      }

      function Compare(id) {
        console.log(id);
        var old_question;
        var reason_per_question;
        for (var item in question_compare.old_question) {
          if (question_compare.old_question[item].id == id) {
            old_question = question_compare.old_question[item];
            const foundReason = result.find((row) => row[0] == id);
            reason_per_question = foundReason[4];
          }
        }
        console.log(old_question);
        $("#compare").modal("show");
        $(".old-question-content").text(old_question.question_content);
        $(".old-answer").text(old_question.ans);
        $(".old-difficulty").text(old_question.difficulty);
        $(".old-learning_outcome").text(old_question.learning_outcome);
        $(".old-subchapters").text(old_question.subchapters);
        $(".old-instruction").text(old_question.instruction);

        var new_question = question_compare.new_question;
        console.log(new_question);

        $(".new-question-content").text(new_question.question_content);
        $(".new-answer").text(new_question.ans);
        $(".new-difficulty").text(new_question.difficulty);
        $(".new-learning_outcome").text(new_question.learning_outcome);
        $(".new-subchapters").text(new_question.subchapters);
        $(".new-instruction").text(new_question.instruction);
        $(".new-reasoning").text(reason_per_question);
      }

      function log_compare(id) {
        console.log(id);
        var old_question;
        for (var item in log_question_compare.old_question) {
          if (log_question_compare.old_question[item].id == id) {
            old_question = log_question_compare.old_question[item];
            const foundReason = result.find((row) => row[0] == id);
            reason_per_question = foundReason[4];
          }
        }
        console.log(old_question);
        $("#compare").modal("show");
        $(".old-question-content").text(old_question.question_content);
        $(".old-answer").text(old_question.ans);
        $(".old-difficulty").text(old_question.difficulty);
        $(".old-learning_outcome").text(old_question.learning_outcome);
        $(".old-subchapters").text(old_question.subchapters);
        $(".old-instruction").text(old_question.instruction);

        var new_question = log_question_compare.new_question;
        console.log(new_question);

        $(".new-question-content").text(new_question.question_content);
        $(".new-answer").text(new_question.ans);
        $(".new-difficulty").text(new_question.difficulty);
        $(".new-learning_outcome").text(new_question.learning_outcome);
        $(".new-subchapters").text(new_question.subchapters);
        $(".new-instruction").text(new_question.instruction);
        $(".new-reasoning").text(reason_per_question);
      }

      selectNumberQuestion();
      function selectNumberQuestion() {
        var numberQuestion = $("#numberQuestion").val();
        console.log(numberQuestion);
        var num = 0;
        $("#list-question tr").each(function () {
          if (num <= numberQuestion) {
            $(this).removeClass("hide");
          } else {
            $(this).addClass("hide");
          }
          num = num + 1;
        });
      }

      function BackToPage(from, to) {

        $("#list-question tbody tr").remove();

        $(".page-" + from).each(function () {
          $(this).addClass("hidden");
        });
        $(".page-" + to).each(function () {
          $(this).removeClass("hidden");
        });
      }

      function save_question() {
        var new_question = question_compare.new_question;
        console.log(new_question);
        
        fetch('/save_question', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ new_question: new_question })
        })
        .then(response => response.json())
        document.getElementById("successModal").classList.remove("hidden");
      }

      function closeModal() {
        document.getElementById("successModal").classList.add("hidden");
        BackToPage(2, 1);
      }
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
